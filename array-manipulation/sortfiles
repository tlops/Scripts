#!/bin/bash
# This script sort through a list of filess generated by "ls -l" and returns a
# list with unique names of files. I appended related files to test

tmp_files="list_files.MmO"
tmp_video="falalist"
tmp_useless=$(mktemp /tmp/flv_files.XXX) # the flv files

get_Files (){
        # This function returns a list of unique mp4 video clips
        video_array=()
        grep '^-' $tmp_files | awk '{print $9}' > $tmp_video
        tmp_videoarray=$(cat $tmp_video)
        for video in ${tmp_videoarray[@]}; do
                teststring=${video: -6}		# stores last 6 characters of the string
                teststringxl=${video: -7}	# stores last 7 characters of the string
	#	echo $video
                if [ "$teststring" == "_l.mp4" ] || [ "$teststring" == "_m.mp4" ]; then
                        clip_name=${video::-6} 	# Removes the last 6 character
                        video_array+=("$clip_name")	# Appends to the list
                elif [ "$teststringxl" == "_xl.mp4" ]; then
                        clip_name=${video::-7}	# Removes the last 7 character
                        video_array+=("$clip_name")	# Appends to the list
		else
			#echo $video >> $tmp_useless
			:
		fi
	done
        echo ${video_array[@]}
	# remove duplicate filenames from list to get unique file names
	readarray -t filename_array < <(printf '%s\n' "${video_array[@]}" | awk '!x[$0]++')
	echo ""
	echo "Unique list"
	echo ${filename_array[@]}
}
get_Files
rm -f $tmp_useless
